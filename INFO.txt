Infos about deployment etc.
---------------------------



0) Web Host:      93.186.200.140
   moniker:       myloc

1) Web Server:    nginx
   DocRoot:       /var/www/nginx-default
   User/Group:    www-data:www-data
   Home:          /var/www
   Reverse Proxy: -> 127.0.0.1:5000

2) Perl: Perlbrew
   User/Group:    sites:sites
   Install Dir:   /home/sites/perl5/perlbrew
   Binaries:      ./bin/*, ./perls/*/bin/*
   Using Perl:    5.14.2

3) Catalyst App
   Root Dir:      /home/sites/StatisticsCollector
   User/Group:    sites:sites
   Perl Libs:     ./perl5lib
   Init-Script:   ./script/init.d_starman
   Port:          127.0.0.1:5000
   Deploy Script: ./script/statisticscollector_rsync.sh



------ nginx config:
server {
    listen 81 default;
    server_name statistics;
    access_log /var/log/nginx/statistics.access.log;
    
    # CSS is served statically
    location /css/ {
        alias /home/sites/StatisticsCollector/root/_static_css/;
    }
    
    # JS is served statically
    location /js/ {
        alias /home/sites/StatisticsCollector/root/_static_js/;
    }
    
    # everything else is passed to Catalyst
    location / {
        proxy_set_header Host $http_host;
        proxy_set_header X-Forwarded-Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Port 81; #this is important for Catalyst Apps!
        proxy_pass http://localhost:5000;
    }
}


------- order of deployment:

# adduser --shell /bin/bash sites
# su - sites

$ curl -kL http://xrl.us/perlbrewinstall | bash
$ . perl5/perlbrew/etc/bashrc
$ cat >> .profile
. ~/perl5/perlbrew/etc/bashrc
^D
$ perlbrew init
$ perlbrew install 5.14.2
$ perlbrew install-cpanm

$ mkdir pid

$ mkdir <name_of_site>
$ cd <name_of_site>
$ mkdir perl5lib
$ cpanm -L perl5lib Catalyst::Runtime Catalyst::Devel

(deploy app)

$ cpanm -L perl5libs --installdeps .

(modify init.d script)

# /etc/init.d/site_deamon start
